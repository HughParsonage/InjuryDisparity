---
title: "Untitled"
author: "Corinne Riddell"
date: "10/4/2017"
output: html_document
---

Note, this won't run on its own -- need to compile the other Rmd file first. 

**Other graphs, fyi**

**Figure 1b: Difference in age-standardized homicide fatalities rates for females by state, firearm involvement, and race, 2008-2014**

```{r figure1b, fig.width=5, fig.height=7, echo = F, warning=F}
ggplot(Females_AllAges_0814, aes(y = ST.order.RD.homicide, x = adjusted.homicide.white)) + 
  geom_segment(aes(x = adjusted.homicide.white, xend = adjusted.homicide.black, 
                   y = ST.order.RD.homicide, yend = ST.order.RD.homicide), 
               lwd = 2, col = "navy", alpha = 0.5) +
  geom_point(aes(col = "NH White", size = average.pop.white)) + #alpha = ifelse(death.homicide.black < 20, 0.7, 1)
  geom_point(aes(x = adjusted.homicide.black, col = "NH Black", size = average.pop.black)) + #alpha = ifelse(death.homicide.black < 20, 0.7, 1),
  scale_color_manual(values = c("navy", "#fd8d3c")) +
  scale_alpha_continuous(guide = F) +
  scale_size_area(breaks = c(16600, 100000, 500000, 1500000, 3000000, 7000000)) +
  ylab("") +
  xlab("Homicide mortality per 100k") + 
  theme_bw() + 
  guides(color = guide_legend(title = " "), size = guide_legend(title = "Population")) + 
  theme(legend.position = c(0.8, 0.25), 
        plot.title = element_text(size = 10),
        legend.background = element_rect(fill=alpha('white', 0.2)),
        strip.background = element_rect(fill="white"), 
        strip.text.x = element_text(size = 12),
        strip.text.y = element_text(size = 12)) + 
  scale_x_continuous(limits = c(0, 80), labels = seq(0, 80, 20), breaks = seq(0, 80, 20)) +
  geom_text(data = subset(Females_AllAges_0814, is.na(adj.RD.homicide)==F),
            aes(x = adjusted.homicide.black + 2, label = paste0("+", round(adj.RD.homicide))),
            size = 3, col = "navy") +
  facet_wrap( ~ type)  
```

**Figure 2b: Difference in suicide fatalities rates for females by state, firearm involvement, and race, 2008-2014**

```{r figure2b, fig.width=5, fig.height=7, echo = F, warning=F}
ggplot(Females_AllAges_0814, aes(y = ST.order.RD.suicide, x = adjusted.suicide.white)) + 
  geom_segment(aes(x = adjusted.suicide.white, xend = adjusted.suicide.black, 
                   y = ST.order.RD.suicide, yend = ST.order.RD.suicide), 
               lwd = 2, col = "#fd8d3c", alpha = 0.5) +
  geom_point(aes(col = "NH White", size = average.pop.white)) + #alpha = ifelse(death.homicide.black < 20, 0.7, 1)
  geom_point(aes(x = adjusted.suicide.black, col = "NH Black", size = average.pop.black)) + #, alpha = ifelse(death.homicide.black < 20, 0.7, 1)
  scale_color_manual(values = c("navy", "#fd8d3c")) +
  scale_alpha_continuous(guide = F) +
  scale_size_area(breaks = c(16600, 100000, 500000, 1500000, 3000000, 7000000)) +
  ylab("") + xlab("Suicide mortality per 100k") + theme_bw() + 
  guides(color = guide_legend(title = " "), size = guide_legend(title = "Population")) + 
  theme(legend.position = c(0.8, 0.25), 
        plot.title = element_text(size = 10),
        legend.background = element_rect(fill=alpha('white', 0.2)),
        strip.background = element_rect(fill="white"), 
        strip.text.x = element_text(size = 12),
        strip.text.y = element_text(size = 12)) + 
  scale_x_continuous(limits = c(0, 80), labels = seq(0, 80, 20), breaks = seq(0, 80, 20)) +
  geom_text(data = subset(Females_AllAges_0814, is.na(adj.RD.suicide)==F), 
            aes(x = adjusted.suicide.white + 2, label = paste0("+", round(-adj.RD.suicide))), size = 3, col = "#fd8d3c") +
  facet_wrap(~type)
```


The suicide rates for blacks and whites are correlated. The ratio of white to black suicides is approximately X:1.

```{r, echo=F, warning=F}
ggplot(Males_AllAges_0814, aes(adjusted.suicide.white, adjusted.suicide.black)) + 
  geom_text(aes(label = ST, col = type), size = 2.5) +
  guides(color = guide_legend(title = " ")) +
  ylab("Suicide rate for blacks") +
  xlab("Suicide rate for whites") +
  theme_bw()

Males_AllAges_0814 %>% 
  group_by(type) %>% 
  summarise(cor.suicide = cor(adjusted.suicide.black, adjusted.suicide.white, use = "complete.obs"))

ggplot(subset(Males_AllAges_0814, type == "Firearm"), aes(adjusted.suicide.white, adjusted.suicide.black)) + 
  geom_label(aes(label = ST, col = gun.level), size = 2.5, alpha = 0.5) +
  guides(color = guide_legend(title = " ")) +
  ylab("Suicide rate for blacks") +
  xlab("Suicide rate for whites") +
  theme_bw()

```

The homicide rates for blacks and whites are not correlated at all and are wildly different in magnitude.

```{r, echo=F, warning=F}
ggplot(Males_AllAges_0814, aes(adjusted.homicide.white, adjusted.homicide.black)) + 
  geom_text(aes(label = ST, col = type), size = 2.5) +
  ylab("Homicide rate for blacks") +
  xlab("Homicide rate for whites") +
  theme_bw()

ggplot(subset(Males_AllAges_0814, type == "Firearm"), aes(adjusted.homicide.white, adjusted.homicide.black)) + 
  geom_label(aes(label = ST, col = gun.level), size = 2.5, alpha = 0.5) +
  ylab("Homicide rate for blacks") +
  xlab("Homicide rate for whites") +
  theme_bw()

```

```{r, echo=F, eval=F}
NHBM_1214 <- read.csv("/Users/corinneriddell/Dropbox/Funding/WilliamTGrant/Data/NHBlackMales_byState_1214.csv", header = T)
NHBM_1214 <- NHBM_1214 %>% 
  rename(deaths.black = Deaths, pop.black = Population) %>% 
  mutate(Race = "Non-Hispanic Black", crude.black = (deaths.black/pop.black)*100000) %>%
  select(ST, deaths.black, pop.black, crude.black)

NHWM_1214 <- read.csv("/Users/corinneriddell/Dropbox/Funding/WilliamTGrant/Data/NHWhiteMales_byState_1214.csv", header = T)
NHWM_1214 <- NHWM_1214 %>% 
  rename(deaths.white = Deaths, pop.white = Population) %>% 
  mutate(Race = "Non-Hispanic White", crude.white = (deaths.white/pop.white)*100000) %>% 
  select(ST, deaths.white, pop.white, crude.white)

HM_1214 <- read.csv("/Users/corinneriddell/Dropbox/Funding/WilliamTGrant/Data/HispanicMales_byState_1214.csv", header = T)
HM_1214 <- HM_1214 %>% 
  rename(deaths.hispanic = Deaths, pop.hispanic = Population) %>% 
  mutate(Race = "Hispanic", crude.hispanic = (deaths.hispanic/pop.hispanic)*100000) %>% 
  select(ST, deaths.hispanic, pop.hispanic, crude.hispanic)

dat.1214 <- merge(NHBM_1214, NHWM_1214, by = c("ST")) %>% mutate(BW.RD = crude.black - crude.white)
dat.1214 <- merge(dat.1214, HM_1214, by = c("ST")) %>% mutate(HW.RD = crude.hispanic - crude.white)

dat.1214 <- dat.1214 %>% mutate(ST.order.BW.RD = reorder(ST, BW.RD),
                                ST.order.HW.RD = reorder(ST, HW.RD)) %>% arrange(BW.RD)
```

```{r, echo=F, eval=F}
ggplot(subset(dat.1214, is.na(BW.RD) == F), aes(y = ST.order.BW.RD, x = crude.white)) + 
  geom_segment(aes(x = crude.white, xend = crude.black, y = ST.order.BW.RD, yend = ST.order.BW.RD), lwd = 1.5, col = "grey") +
  geom_point(aes(col = "White")) + geom_point(aes(x = crude.black, col = "Black")) + 
  scale_color_manual(values = c("navy", "#feb24c")) +
  ylab("") + xlab("Firearm mortality per 100k") + theme_bw() + 
  guides(color = guide_legend(title = " ")) + 
  ggtitle("Figure 1. Number of firearm fatalities, \nnon-Hispanic blacks vs. non-Hispanic whites, \n5 to 24 years old, 2012-2014") +
  theme(legend.position = c(0.8, 0.13), plot.title = element_text(size = 10),
        legend.background = element_rect(fill=alpha('white', 0.2))) + 
  labs(caption = "(Fig. created by Riddell. Data from WISQARS)") +
  scale_x_continuous(limits = c(0, 90), labels = seq(0, 80, 20), breaks = seq(0, 80, 20)) +
  geom_text(aes(x = crude.black + 8, label = paste0("+", round(BW.RD))
                ), size = 3) 
```

```{r, echo=F, eval=F}
ggplot(subset(dat.1214, is.na(HW.RD) == F), aes(y = ST.order.HW.RD, x = crude.white)) + 
  geom_segment(aes(x = crude.white, xend = crude.hispanic, y = ST.order.HW.RD, yend = ST.order.HW.RD), lwd = 1.5, col = "grey") +
  geom_point(aes(col = "White")) + geom_point(aes(x = crude.hispanic, col = "Hispanic")) + 
  scale_color_manual(values = c("red", "#feb24c")) +
  ylab("") + xlab("Firearm mortality per 100k") + theme_bw() + 
  guides(color = guide_legend(title = " ")) + 
  ggtitle("Figure 2. Number of firearm fatalities, \nHispanic vs. non-Hispanic whites, \n 5 to 24 years old, 2012-2014") +
  theme(legend.position = c(0.8, 0.13), plot.title = element_text(size = 10),
        legend.background = element_rect(fill=alpha('white', 0.2))) + 
  labs(caption = "(Fig. created by Riddell. Data from WISQARS)") +
  scale_x_continuous(limits = c(0, 20), labels = seq(0, 20, 4), breaks = seq(0, 20, 4)) +
  geom_text(data = subset(dat.1214, HW.RD>=0), aes(x = crude.hispanic + 1, label = paste0("+", round(HW.RD))
                ), size = 3) +
  geom_text(data = subset(dat.1214, HW.RD<0), aes(x = crude.hispanic - 1, label = round(HW.RD)
                ), size = 3) 
```

```{r, echo=F, eval=F}
dat.1214$ST.order.BW.RD <- forcats::fct_relevel(f = dat.1214$ST.order.BW.RD,
                                                "HI", "NH", "VT", "ME", "SD", "MT", "ID", "ND", "WY", "AK", "DE", "DC",
                                                "UT", "OR", "WA", "AZ", "CO", "IA", "MN", "TX", "VA",
                                                "SC", "GA", "NV", "WV", "NC", "MS", "MA",
                                                "NY", "KY", "KS", "AR", "CT", "NM", "MD",
                                                "FL", "AL", "OK", "NE", "WI", "TN", "CA",
                                                "LA", "NJ", "OH", "MO", "MI", "PA", "IN",
                                                "IL")

ggplot(dat.1214, aes(y = ST.order.BW.RD, x = crude.white)) + 
  geom_segment(aes(x = crude.white, xend = crude.black, y = ST.order.BW.RD, yend = ST.order.BW.RD), lwd = 2, col = "navy", alpha = 0.5) +
  geom_segment(aes(x = crude.white, xend = crude.hispanic, y = ST.order.BW.RD, yend = ST.order.BW.RD), lwd = 1, col = "red", alpha = 0.5) +
  geom_point(aes(col = "NH White")) + 
  geom_point(aes(x = crude.black, col = "NH Black")) + 
  geom_point(aes(x = crude.hispanic, col = "Hispanic")) +
  scale_color_manual(values = c("red", "navy", "#feb24c")) +
  ylab("") + xlab("Firearm mortality per 100k") + theme_bw() + 
  guides(color = guide_legend(title = " ")) + 
  ggtitle("Figure 1. Number of firearm fatalities to boys and men aged 5 to 24 years old, 2012-2014") +
  theme(legend.position = c(0.8, 0.13), plot.title = element_text(size = 10),
        legend.background = element_rect(fill=alpha('white', 0.2))) + 
  #labs(caption = "(Fig. created by Riddell. Data from WISQARS)") +
  scale_x_continuous(limits = c(0, 90), labels = seq(0, 80, 20), breaks = seq(0, 80, 20)) +
  geom_text(data = subset(dat.1214, is.na(BW.RD)==F), aes(x = crude.black + 8, label = paste0("+", round(BW.RD))
                ), size = 3, col = "navy") +
  geom_text(data = subset(dat.1214, is.na(HW.RD)==F & HW.RD>=0), aes(x = crude.hispanic + 3, label = paste0("+", round(HW.RD))
                ), size = 3, col = "red") +
  geom_text(data = subset(dat.1214, is.na(HW.RD)==F & HW.RD<0), aes(x = crude.hispanic - 3, label = round(HW.RD)
                ), size = 3, col = "red") 
```

```{r Figure 3_OLD_versions, fig.width=9, fig.height=3, echo = F, warning=F, eval=F}
ggplot(Males_AllAges_0814, aes(adjusted.suicide.white, adjusted.homicide.white)) + 
  geom_text(aes(label = ST, col = type), size = 2.5) +
  guides(color = guide_legend(title = " ")) + 
  ylab("Age-standardized white homicide rate\n(per 100,000)") +
  xlab("Age-standardized white suicide rate (per 100,000)") + 
  coord_equal(xlim = c(5, 45)) + theme_bw()

ggplot(subset(Males_AllAges_0814, type == "Firearm"), aes(crude.suicide.white, crude.homicide.white)) + 
  geom_label(aes(label = ST, col = gun.level, size = average.pop.white), alpha = 0.5) +
  guides(color = guide_legend(title = " ")) + 
  ylab("White Homicide Rate\n(per 100,000)") +
  xlab("White Suicide Rate (per 100,000)") + 
  theme_bw() +
  coord_equal(xlim = c(5, 45)) 

ggplot(subset(Males_AllAges_0814, type == "Firearm"), aes(crude.suicide.white, crude.homicide.white)) + 
  geom_label(aes(label = ST, col = gun.level, size = average.pop.white), alpha = 0.5) +
  guides(color = guide_legend(title = " ")) + 
  ylab("White Homicide Rate\n(per 100,000)") +
  xlab("White Suicide Rate (per 100,000)") + 
  theme_bw()
```

```{r figure4_OLD_versions, fig.height=3, fig.width=9, echo=F, warning=F, eval=F}
ggplot(Males_AllAges_0814, aes(crude.suicide.black, crude.homicide.black)) + 
  geom_text(aes(label = ST, col = type), size = 2.5) +
  guides(color = guide_legend(title = " ")) + 
  ylab("Black Homicide Rate (per 100,000)") +
  xlab("Black Suicide Rate\n(per 100,000)") + 
  coord_equal(ylim = c(5, 65)) + theme_bw()

ggplot(subset(Males_AllAges_0814, type == "Firearm"), aes(crude.suicide.black, crude.homicide.black)) + 
  geom_label(aes(label = ST, col = gun.level, size = average.pop.black), alpha = 0.5) +
  guides(color = guide_legend(title = " ")) + 
  ylab("Black Homicide Rate (per 100,000)") +
  xlab("Black Suicide Rate\n(per 100,000)") + 
  coord_equal(ylim = c(5, 65)) + theme_bw()

ggplot(subset(Males_AllAges_0814, type == "Firearm"), aes(crude.suicide.black, crude.homicide.black)) + 
  geom_label(aes(label = ST, col = gun.level, size = average.pop.black), alpha = 0.5) +
  guides(color = guide_legend(title = " ")) + 
  ylab("Black Homicide Rate (per 100,000)") +
  xlab("Black Suicide Rate\n(per 100,000)") + 
  theme_bw()

```